---
title: "Model analysis"
author: "Daijiang Li"
date: "`r format(Sys.time(), '%d %B, %Y')`" 
output: 
  html_document:
    theme: readable
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)
knitr::opts_knit$set(root.dir = normalizePath("../"))
```

First, read the data, do separate LM for each species and return all the results.

`bio1` = Annual Temperature; `bio4` = Temperature seasonality; `bio12` = Annual Precipitation; `bio15` = Precipitation seasonality;

```{r}
source("src/00_pkg_funcs.r", verbose = F, echo = F)
source("src/01_generate_data_diagnostics.r")
source("src/02_traits.R")
source("src/03_lm.R")
```

Now, we can move on to look at the model results. We decided to do two sets of analyses:

1. Look at partial R^2^s of temperature related predictors (`Temp` and `Temp Seasonality`) and precipitation related predictors (`Precip` and `Precip Seasonality`) and see what kind of "traits" predict whether temperature or precipitation explains more variation in body mass.
2. Look at estimates of coefficients of LMs and use the similar set of traits as predictors.

# Part 1: partial R^2^

```{r}
model_results = mutate(model_results, 
                       partial_r2_bio1_bio4 = ifelse(is.na(partial_r2_bio1_bio4), 
                                                     partial_r2_bio1, 
                                                     partial_r2_bio1_bio4),
                       ratio_temp_precip_r2 = partial_r2_bio1_bio4/partial_r2_bio12_bio15,
                       diff_temp_precip_r2 = partial_r2_bio1_bio4 - partial_r2_bio12_bio15)
hist(model_results$ratio_temp_precip_r2)
hist(model_results$diff_temp_precip_r2)
```

So, I will just take the differences between their partial R^2^s because it is easier for us to interpret.

Let's standardize predictors first. Also, note that the Elton traits of birds and mammals are generated from different datasets and thus are not directly comparable. To use these Elton traits, we need to look at birds and mammals separately.

```{r}
model_results = mutate(model_results, mass_mean = log10(mass_mean))

predictors_common = c("mass_mean", 
               "bio1_mean", "bio1_breadth", 
               "bio4_mean", "bio4_breadth", 
               "bio12_mean", "bio12_breadth",
               "bio15_mean", "bio15_breadth")
predictors_taxa = c("habitat_axis1", "habitat_axis2", 
                    "trophic_axis1", "trophic_axis2")

# elton traits for birds and mammals are generated separately, so they are not comparable.
model_results_birds = filter(model_results, taxa == "birds")
model_results_birds[, c(predictors_common, predictors_taxa)] = 
  scale(model_results_birds[, c(predictors_common, predictors_taxa)])

model_results_mammals = filter(model_results, taxa == "mammals")
model_results_mammals[, c(predictors_common, predictors_taxa)] = 
  scale(model_results_mammals[, c(predictors_common, predictors_taxa)])

model_results[, predictors_common] = scale(model_results[, predictors_common])
```

## All species together

Let's look at all species together, but use all predictors except Elton traits.

```{r}
mod_1 = lm(diff_temp_precip_r2 ~ mass_mean + bio1_mean + bio1_breadth + 
             bio4_mean + bio4_breadth +
             bio15_mean + bio15_breadth +
             bio12_mean + bio12_breadth, 
           data = model_results)
summary(mod_1)
summary(step(mod_1, trace = 0))
```

Humm, not much interesting things here. Also, note the very low R^2^!

## Birds

```{r}
mod_2 = lm(diff_temp_precip_r2 ~ mass_mean + bio1_mean + bio1_breadth + 
             bio4_mean + bio4_breadth +
             bio15_mean + bio15_breadth +
             bio12_mean + bio12_breadth +
             habitat_axis1 + habitat_axis2 +
             trophic_axis1 + trophic_axis2, 
           data = model_results_birds)
summary(mod_2)
summary(step(mod_2, trace = 0)) 
```

Higher R^2^! And most of the estimates make sense. So, estimate of `bio1_mean` and `bio4_mean` are both significantly positive, which means that if the distribution area of a species are hot or has strong temperature seasonality, then temperature related predictors (`bio1` and `bio4`) will have higher partial R^2^ (compare with precipitation related variables). The breadth variables are not so intuitive for me ... `Mass_mean` dropped out, which makes sense for birds?

## Mammals

```{r}
mod_3 = lm(diff_temp_precip_r2 ~ mass_mean + bio1_mean + bio1_breadth + 
             bio4_mean + bio4_breadth +
             bio15_mean + bio15_breadth +
             bio12_mean + bio12_breadth +
             habitat_axis1 + habitat_axis2 +
             trophic_axis1 + trophic_axis2, 
           data = model_results_mammals)
summary(mod_3)
summary(step(mod_3, trace = 0)) 
```

The larger the mammals are, the more variation of body mass explained by temperature related variables. Err... definitely different responses with birds. Higher temperature niche, less important of temperature related variables for explaining variations in body mass.

# Part 2: Coef

```{r}
hist(model_results$bio1_estimate)
hist(model_results$bio4_estimate)
hist(model_results$bio12_estimate)
hist(model_results$bio15_estimate)
```

## All species

Let's look at all species first.

```{r}
# bio1
mod_4 = lm(bio1_estimate ~ mass_mean + bio1_mean + bio1_breadth + 
             bio4_mean + bio4_breadth, 
           data = model_results)
summary(mod_4)
summary(step(mod_4, trace = 0))
```

I find `bio4_breadth` is hard to interpret: the higher breath of temperature seasonality, the less effects of `bio1`. Also, note the very low R^2^.

```{r}
# bio12
mod_5 = lm(bio12_estimate ~ mass_mean + 
             bio15_mean + bio15_breadth +
             bio12_mean + bio12_breadth, 
           data = model_results)
summary(mod_5)
summary(step(mod_5, trace = 0))
```

Nothing here.

## Birds

```{r}
# bio1
mod_6 = lm(bio1_estimate ~ mass_mean + bio1_mean + bio1_breadth + 
             bio4_mean + bio4_breadth +
             # + bio15_mean + bio15_breadth +
             # bio12_mean + bio12_breadth +
             habitat_axis1 + habitat_axis2 +
             trophic_axis1 + trophic_axis2, 
           data = model_results_birds)
summary(mod_6)
summary(step(mod_6, trace = 0)) 
```

Nothing here.

```{r}
# bio12
mod_7 = lm(bio1_estimate ~ mass_mean + 
             # bio1_mean + bio1_breadth + 
             # bio4_mean + bio4_breadth +
             bio15_mean + bio15_breadth +
             bio12_mean + bio12_breadth +
             habitat_axis1 + habitat_axis2 +
             trophic_axis1 + trophic_axis2, 
           data = model_results_birds)
summary(mod_7)
summary(step(mod_7, trace = 0)) 
```

Nothing here.

## Mammals

```{r}
# bio1
mod_8 = lm(bio1_estimate ~ mass_mean + bio1_mean + bio1_breadth + 
             bio4_mean + bio4_breadth +
             # + bio15_mean + bio15_breadth +
             # bio12_mean + bio12_breadth +
             habitat_axis1 + habitat_axis2 +
             trophic_axis1 + trophic_axis2, 
           data = model_results_mammals)
summary(mod_8)
summary(step(mod_8, trace = 0)) 
```

Something here. But again, hard to interpret.

```{r}
# bio12
mod_9 = lm(bio1_estimate ~ mass_mean + 
             # bio1_mean + bio1_breadth + 
             # bio4_mean + bio4_breadth +
             bio15_mean + bio15_breadth +
             bio12_mean + bio12_breadth +
             habitat_axis1 + habitat_axis2 +
             trophic_axis1 + trophic_axis2, 
           data = model_results_mammals)
summary(mod_9)
summary(step(mod_9, trace = 0)) 
```

Something here. But again, hard to interpret. And still very low R^2^.


**So, how these results compare with the previous multinomial regression results??**

